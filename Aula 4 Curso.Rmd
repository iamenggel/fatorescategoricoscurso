---
title: "Aula 4 - GLM Binomial ?"
author: "Enggel Carmo"
date: "12/07/2021"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Existem várias situações onde os dados não apresentam essas características  
As respostas são binária(0,1), ou porcentagem, ou proporção

Lembrar que pra resposta binária ou proporção adicionar a coluna do **total** com o valor 1 em todas as linhas
<br>   

### GLM Binomial  
```{r packages, warning=FALSE, message=FALSE}
library(RT4Bio) #gráfico de quantiles
library(gplots) #gráficos de barra
```

### Carregar os dados
```{r}
dados<-read.table("Dados_CursoR.txt",h=T)
attach(dados)
head(dados)
```

### Construção dos modelos   
- (parcial/total)  
- wights = total  
- família binomial  

```{r}
mb0=glm(larvas/ovos~1,weights = ovos,binomial) #modelo nulo, aleatório
mb1=glm(larvas/ovos~Dieta,weights = ovos,binomial) #modelo completo, com efeito do tratament (Dieta)
anova(mb0,mb1,test="Chisq")
```

Análise de deviancia
```{r}
anova(mb1,test="Chisq") #tabela da ANOVA
```

Teste de sobredispersão
- (Envelope)
```{r}
par(mfrow=c(2,2))
plot(mb1,which=c(1:4),pch=20)
rdiagnostic(mb1)
```

Informações para o texto dos resultados
```{r}
summary(mb1)
```
```{r}
102.61/42
```

### Binomial Negativa  

Correção
```{r binomial negativa, warning=FALSE}
help0=glm.nb((larvas/ovos)*100~1) #binomial negativa glm.nb
help1=glm.nb((larvas/ovos)*100~Dieta)
anova(help0,help1)
```

Análise de deviancia
```{r, warning= FALSE}
anova(help1)
```

Análise de dispersão
```{r}
par(mfrow=c(2,2))
plot(help1,which=c(1:4),pch=20)
rdiagnostic(help1)
```
```{r}
summary(help1)
```

### Análise de residuos  
Residual deviance:  80.824  on 42  degrees of freedom
```{r}
80.824/42
```

### Análise descritiva dos dados

```{r}
media1<-tapply((larvas/ovos)*100,Dieta,mean)
media1

erro1<-tapply((larvas/ovos)*100,Dieta, sd)/sqrt(tapply((larvas/ovos)*100,Dieta, length))
erro1
```
```{r}
barplot2(media1,
 plot.ci=T,
 ci.u=media1+erro1,
 ci.l=media1-erro1,
 ylim=c(0,100),
 ylab="Fertilidade (%)",
  names.arg = c("Cochonilha","Ovos", "Pulgão"),
 col=c("gray","lightgreen", "darkgreen"),
 las=1
 )
abline(h=0)
```

### Dados Binomiais de Presença e ausência (0 ou 1)  
<br>
Análise binomial não é a mais recomendada para análise de sobrevivência. Esta é uma característica (mortalidade) que é avaliada e acompanhada ao longo do tempo e são utilizadas outras ferramentas/distribuições (Weibull e Kruskal-Wallis). 
<br>
Então a pergunta aqui é:  
Qual a taxa de sobrevivência no final dos dias de observação?
<br>  
Contrução do modelo para observação do efeito do tratamento  
```{r}
m0=glm(censor/total~1,weights = total,binomial)
pre1=glm(censor/total~Dieta,weights = total,binomial) #modelo
anova(m0,pre1,test="Chisq")
```

Análise de deviancia do modelo com efeito do tratamento
```{r}
anova(pre1,test="Chisq")
```

Análise de sobredispersão
```{r}
par(mfrow=c(2,2))
plot(pre1,which=c(1:4),pch=20)
rdiagnostic(pre1)
```

Apresentação dos dados para os resultados
```{r}
summary(pre1)
```

### Análise de resíduos   

Residual deviance: 49.905  on 42  degrees of freedom
```{r}
49.905/42
```

### Representação gráfica  

```{r}
plot((censor/total)~survive,
 las=1,
 ylab = "Sobrevivência",
 xlim=c(0, 3.0),
 bty= "n")

curve(exp(1.8718-0.7596*x)/(1+exp(1.8718-0.7596*x)), #curva de alto recurso
 add=T,
 lwd=2, #espessura da reta (aumenta o valor = aumenta a espessura)
 lty=4, #estilo da reta (1=contínuo; 2=tracejado)
 col="green")

curve(exp(1.8718-2.8834*x)/(1+exp(1.8718-2.8834*x)), #curva de alto recurso
 add=T,
 lwd=1, #espessura da reta (aumenta o valor = aumenta a espessura)
 lty=1, #estilo da reta (1=contínuo; 2=tracejado)
 col="black")

curve(exp(1.8718-2.8834*x -1.7383 )/(1+exp(1.8718-2.8834*x -1.7383 )), #curva baixo recurso
 add=T,
 lwd=1, #espessura da reta (aumenta o valor = aumenta a espessura)
 lty=2, #estilo da reta (1=contínuo; 2=tracejado)
 col="black")

legend("topleft", #posição da legenda
 c("Pulgão","Cochonilhas", "Ovos"), #informa os fatores
 lty = c(1, 2), #informa as linhas
 col=c("green", "black","black"), #informa a coloração
 bty = "n")
text(1060,0.2,"P < 0.001",font=3)
```
### Análise descritiva  

```{r}
media2=tapply(censor/total,Dieta, mean)
media2

erro2=tapply(censor/total,Dieta, sd)/sqrt(tapply(censor/total,Dieta,
length))
erro2
```
### Gráfico  
```{r, message= FALSE, warning=FALSE}
#install.packages("RColorBrewer")
library(RColorBrewer)

cores <- brewer.pal(3, "Dark2")

cores2 <- brewer.pal(3, "Paired")
cores3 <- brewer.pal(10, "Set2")

library(ggplot2)
barplot2(media2,col=cores2,
 plot.ci=T,
 ci.u=media2+erro2,
 ci.l=media2-erro2,
 ylim=c(0.0,1.0),
 las=1,
 ylab="% Fêmeas vivas",
 names.arg = c("Cochonilhas","Ovos", "Pulgão"),
 )
abline(h=0)
```
```{r}
a <- c(1:10)
color <- colorRampPalette(c("red","yellow", "green"))
color(10)
barplot(a, col=color(10))
abline(h=0)
```
```{r}
b <- c(1:10)
corDegrade <- colorRampPalette(c("green","darkblue")) # Degradê de verde para azul
corDegrade(10)
barplot(b, col=corDegrade(10))
abline(h=0)
```

```{r}
detach(dados)
```

